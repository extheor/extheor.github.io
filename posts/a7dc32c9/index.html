<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Nodejs项目实战开发-博客系统 | MaXiaoYu's Blog</title><meta name="description" content="Nodejs博客系统"><meta name="keywords" content="Nodejs博客系统"><meta name="author" content="Continue.Run,2044580857@qq.com"><meta name="copyright" content="Continue.Run"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/extheor/images/maxiaoyu.ico"><link rel="canonical" href="https://extheor.github.io/posts/a7dc32c9/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Nodejs项目实战开发-博客系统"><meta property="og:url" content="https://extheor.github.io/posts/a7dc32c9/"><meta property="og:site_name" content="MaXiaoYu's Blog"><meta property="og:description" content="Nodejs博客系统"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/extheor/extheor.github.io/img/nodejs.jpg"><meta property="article:published_time" content="2020-08-06T16:10:48.000Z"><meta property="article:modified_time" content="2020-08-06T16:12:31.215Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = '1'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":30,"position":"top","messagePrev":"这篇文章已经发表了","messageNext":"天了，其中某些内容可能已经过时。"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isSidebar: true,
  postUpdate: '2020-08-07 00:12:31'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/css/pool.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/css/iconfont.min.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="MaXiaoYu's Blog" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/extheor/extheor.github.io/img/maxiaoyu.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile1/imgbed/2020/03/21/20200321213747.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">10</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div></div></div><div class="code-close" id="body-wrap"><div id="web_bg" data-type="color"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#nodejs项目实战开发-博客系统持续更新"><span class="toc-number">1.</span> <span class="toc-text"> Nodejs项目实战开发-博客系统（持续更新）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.1.</span> <span class="toc-text"> 前言：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#开发技术"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 开发技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开发工具"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 开发工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#博客前台-项目环境搭建"><span class="toc-number">1.2.</span> <span class="toc-text"> 博客前台 项目环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#首先初始化项目"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 首先初始化项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装一系列第三方npm模块"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 安装一系列第三方npm模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建一系列文件"><span class="toc-number">1.2.3.</span> <span class="toc-text"> 创建一系列文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#新建indexjs文件"><span class="toc-number">1.2.3.1.</span> <span class="toc-text"> 新建index.js文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建static目录"><span class="toc-number">1.2.3.2.</span> <span class="toc-text"> 新建static目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建views目录"><span class="toc-number">1.2.3.3.</span> <span class="toc-text"> 新建views目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建router目录"><span class="toc-number">1.2.3.4.</span> <span class="toc-text"> 新建router目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建middleware目录"><span class="toc-number">1.2.3.5.</span> <span class="toc-text"> 新建middleware目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新建model目录"><span class="toc-number">1.2.3.6.</span> <span class="toc-text"> 新建model目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#这些文件之间的一些关系"><span class="toc-number">1.2.3.7.</span> <span class="toc-text"> 这些文件之间的一些关系</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#博客前台-模板文件导入"><span class="toc-number">1.3.</span> <span class="toc-text"> 博客前台 模板文件导入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在router目录下新建indexjs文件"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 在router目录下新建index.js文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#博客前台-封装数据库操作"><span class="toc-number">1.4.</span> <span class="toc-text"> 博客前台 封装数据库操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#博客前台-首页最新博文"><span class="toc-number">1.5.</span> <span class="toc-text"> 博客前台 首页最新博文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#博客前台-导航条"><span class="toc-number">1.6.</span> <span class="toc-text"> 博客前台 导航条</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#博客前台-文章列表"><span class="toc-number">1.7.</span> <span class="toc-text"> 博客前台 文章列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#博客前台-文章搜索"><span class="toc-number">1.8.</span> <span class="toc-text"> 博客前台 文章搜索</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/extheor/extheor.github.io/img/nodejs.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">MaXiaoYu's Blog</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Nodejs项目实战开发-博客系统</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-08-06T16:10:48.000Z" title="发表于 2020-08-07 00:10:48">2020-08-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-08-06T16:12:31.215Z" title="更新于 2020-08-07 00:12:31">2020-08-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Nodejs%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/">Nodejs博客系统</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="nodejs项目实战开发-博客系统持续更新"><a class="markdownIt-Anchor" href="#nodejs项目实战开发-博客系统持续更新"></a> Nodejs项目实战开发-博客系统（持续更新）</h1>
<blockquote>
<p>个人博客系统</p>
</blockquote>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言：</h2>
<h3 id="开发技术"><a class="markdownIt-Anchor" href="#开发技术"></a> 开发技术</h3>
<table>
<thead>
<tr>
<th>技术</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>Node</td>
<td>^14.3.0</td>
</tr>
<tr>
<td>ejs</td>
<td>^3.1.3</td>
</tr>
<tr>
<td>express</td>
<td>^4.17.1</td>
</tr>
<tr>
<td>express-session</td>
<td>^</td>
</tr>
<tr>
<td>mysql</td>
<td>^2.18.1</td>
</tr>
</tbody>
</table>
<h3 id="开发工具"><a class="markdownIt-Anchor" href="#开发工具"></a> 开发工具</h3>
<table>
<thead>
<tr>
<th>技术</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>VSCode</td>
<td>^1.47.3.0</td>
</tr>
<tr>
<td>MySql</td>
<td>^8.0.12</td>
</tr>
<tr>
<td>PhpStudy</td>
<td>^8.1.0.7</td>
</tr>
</tbody>
</table>
<h2 id="博客前台-项目环境搭建"><a class="markdownIt-Anchor" href="#博客前台-项目环境搭建"></a> 博客前台 项目环境搭建</h2>
<h3 id="首先初始化项目"><a class="markdownIt-Anchor" href="#首先初始化项目"></a> 首先初始化项目</h3>
<p>在终端输入命令</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>
<p>会生成一个 <code>package.json</code> 文件</p>
<h3 id="安装一系列第三方npm模块"><a class="markdownIt-Anchor" href="#安装一系列第三方npm模块"></a> 安装一系列第三方npm模块</h3>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i express</span><br><span class="line">npm i ejs</span><br><span class="line">npm i mysql</span><br></pre></td></tr></table></figure>
<p>会生成一个 <code>package-lock.json</code> 文件</p>
<h3 id="创建一系列文件"><a class="markdownIt-Anchor" href="#创建一系列文件"></a> 创建一系列文件</h3>
<h4 id="新建indexjs文件"><a class="markdownIt-Anchor" href="#新建indexjs文件"></a> 新建index.js文件</h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 入口函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="comment">// 创建主应用</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模板引擎的设置</span></span><br><span class="line">app.set(<span class="string">"view engine"</span>, <span class="string">"html"</span>);</span><br><span class="line">app.set(<span class="string">"views"</span>, <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/views`</span>);</span><br><span class="line">app.engine(<span class="string">"html"</span>, <span class="built_in">require</span>(<span class="string">"ejs"</span>).renderFile); <span class="comment">// 用ejs模板渲染html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态资源配置</span></span><br><span class="line">app.use(express.static(<span class="string">"static"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听服务器</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>修改 <code>package.json</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>自定义启动命令</p>
<p>把上面的代码改成以下代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"start"</span>: <span class="string">"node index.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="新建static目录"><a class="markdownIt-Anchor" href="#新建static目录"></a> 新建static目录</h4>
<blockquote>
<p>静态资源目录</p>
</blockquote>
<p>里面存放 css js img 等等的静态资源</p>
<h4 id="新建views目录"><a class="markdownIt-Anchor" href="#新建views目录"></a> 新建views目录</h4>
<blockquote>
<p>模板目录</p>
</blockquote>
<p>里面存放模板文件</p>
<h4 id="新建router目录"><a class="markdownIt-Anchor" href="#新建router目录"></a> 新建router目录</h4>
<blockquote>
<p>子应用目录</p>
</blockquote>
<p>将我们的程序进行模块化管理，每一个模块都将视为一个子应用</p>
<h4 id="新建middleware目录"><a class="markdownIt-Anchor" href="#新建middleware目录"></a> 新建middleware目录</h4>
<blockquote>
<p>中间件目录</p>
</blockquote>
<p>与路由器配套的一些操作方法，在路由加载页面之前获取所需要的一些数据</p>
<h4 id="新建model目录"><a class="markdownIt-Anchor" href="#新建model目录"></a> 新建model目录</h4>
<blockquote>
<p>数据模型目录</p>
</blockquote>
<p>操作数据库的一些文件</p>
<h4 id="这些文件之间的一些关系"><a class="markdownIt-Anchor" href="#这些文件之间的一些关系"></a> 这些文件之间的一些关系</h4>
<p>从数据库中进行增删改查，把得到的一些数据返回给中间件，由中间件返回给路由，由路由进行页面的渲染和加载，最后返回给客户端</p>
<h2 id="博客前台-模板文件导入"><a class="markdownIt-Anchor" href="#博客前台-模板文件导入"></a> 博客前台 模板文件导入</h2>
<p>在views目录和static目录下导入文件</p>
<p>导入完成之后可以把重复的代码提取出来，进行简化处理</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>('<span class="attr">header.html</span>') <span class="attr">-</span>%&gt;</span></span><br><span class="line">html代码不重复的部分</span><br><span class="line"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>('<span class="attr">footer.html</span>') <span class="attr">-</span>%&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="在router目录下新建indexjs文件"><a class="markdownIt-Anchor" href="#在router目录下新建indexjs文件"></a> 在router目录下新建index.js文件</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页子应用（首页路由）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="comment">// 首页子应用</span></span><br><span class="line"><span class="keyword">const</span> indexApp = express();</span><br><span class="line"></span><br><span class="line">indexApp.get(<span class="string">"/"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.render(<span class="string">"index"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把这个子应用导出去</span></span><br><span class="line"><span class="built_in">module</span>.exports = indexApp;</span><br></pre></td></tr></table></figure>
<p>然后在myblog下的 <code>index.js</code> 中调用首页子应用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用首页子应用</span></span><br><span class="line">app.use(<span class="regexp">/\/(index)?/</span>, <span class="built_in">require</span>(<span class="string">"./router/index"</span>));</span><br></pre></td></tr></table></figure>
<p>启动服务</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>
<p>浏览器输入127.0.0.1:3000 出现以下页面说明搭建成功</p>
<p><img src= "https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/loading9.gif" data-lazy-src="https://s1.ax1x.com/2020/08/05/a6aqIg.png" alt="a6aqIg.png" /></p>
<h2 id="博客前台-封装数据库操作"><a class="markdownIt-Anchor" href="#博客前台-封装数据库操作"></a> 博客前台 封装数据库操作</h2>
<p>在model目录下新建 <code>model.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">"mysql"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据模型的基类</span></span><br><span class="line"><span class="comment"> * 封装了数据库操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 连接对象</span></span><br><span class="line">  <span class="keyword">static</span> conn = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 数据库连接方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> connection() &#123;</span><br><span class="line">    Model.conn = mysql.createConnection(&#123;</span><br><span class="line">      host: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">      user: <span class="string">"root"</span>,</span><br><span class="line">      password: <span class="string">"lijiazhao123"</span>,</span><br><span class="line">      database: <span class="string">"blog"</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    Model.conn.connect(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`数据库连接失败：<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 关闭数据库连接</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> end() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != Model.conn) &#123;</span><br><span class="line">      Model.conn.end();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通用查询方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>sql 要执行的SQL语句</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>params 给SQL语句的占位符进行赋值的参数数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> query(sql, params = []) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.connection();</span><br><span class="line"></span><br><span class="line">      Model.conn.query(sql, params, (err, results) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resolve(results);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.end();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在model目录下新建 <code>article.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章数据模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">module.exports = class Article extends require("./model") &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;integer&#125;</span> </span>num 条目数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> getHot(num) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> sql =</span><br><span class="line">        <span class="string">"SELECT id,title,content,`time` FROM article WHERE hot = 1 LIMIT ?"</span>;</span><br><span class="line">      <span class="keyword">this</span>.query(sql, num)</span><br><span class="line">        .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">          resolve(results);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">`获取热门文章失败：<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在middleware目录下新建 <code>article.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Article = <span class="built_in">require</span>(<span class="string">"../model/article"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章中间件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取热门文章</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getHot: <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    Article.getHot(<span class="number">3</span>)</span><br><span class="line">      .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">        req.hots = results;</span><br><span class="line">        next();</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        next(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>再由中间件返回给路由</p>
<p>将router目录下的 <code>index.js</code> 进行修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页子应用（首页路由）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> article = <span class="built_in">require</span>(<span class="string">"../middleware/article"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首页子应用</span></span><br><span class="line"><span class="keyword">const</span> indexApp = express();</span><br><span class="line"></span><br><span class="line">indexApp.get(<span class="string">"/"</span>, [article.getHot], (req, res) =&gt; &#123;</span><br><span class="line">  res.render(<span class="string">"index"</span>, &#123; <span class="attr">hots</span>: req.hots &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把这个子应用导出去</span></span><br><span class="line"><span class="built_in">module</span>.exports = indexApp;</span><br></pre></td></tr></table></figure>
<p>启动服务显示以下页面</p>
<p><img src= "https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/loading9.gif" data-lazy-src="https://s1.ax1x.com/2020/08/06/acXJzD.png" alt="acXJzD.png" /></p>
<p>发现这个时间的格式有点别扭，修改为本地时间</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">hot.time.toLocaleString</span>() %&gt;</span></span><br></pre></td></tr></table></figure>
<p>发现这个内容有点别扭</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= hot.content.replace(/&lt;[^&gt;]+&gt;/g,"").substring(0,100) %&gt;</span><br></pre></td></tr></table></figure>
<p>修改后如下图：</p>
<p><img src= "https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/loading9.gif" data-lazy-src="https://s1.ax1x.com/2020/08/06/agNIp9.png" alt="agNIp9.png" /></p>
<h2 id="博客前台-首页最新博文"><a class="markdownIt-Anchor" href="#博客前台-首页最新博文"></a> 博客前台 首页最新博文</h2>
<p>数据库查询</p>
<p>在model目录下的 <code>article.js</code> 文件中新增以下方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取文章列表</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">static</span> getList() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> sql =</span><br><span class="line">        <span class="string">"SELECT id,title,content,`time` FROM article ORDER BY time DESC"</span>;</span><br><span class="line">      <span class="keyword">this</span>.query(sql)</span><br><span class="line">        .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">          resolve(results);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">`获取文章列表失败：<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>把查询到的数据交给中间件</p>
<p>在middleware目录下的 <code>article.js</code> 文件中新增以下方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取最新文章</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  getList: <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    Article.getList()</span><br><span class="line">      .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">        req.articles = results;</span><br><span class="line">        next();</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        next(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>在由中间件交给路由渲染到页面中</p>
<p>在router目录下的 <code>index.js</code> 文件中修改以下代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">indexApp.get(<span class="string">"/"</span>, [article.getHot, article.getList], (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; hots, articles &#125; = req;</span><br><span class="line">  res.render(<span class="string">"index"</span>, &#123; hots, articles &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>开启服务，出现以下页面</p>
<p><img src= "https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/loading9.gif" data-lazy-src="https://s1.ax1x.com/2020/08/06/a2sUVs.png" alt="a2sUVs.png" /></p>
<h2 id="博客前台-导航条"><a class="markdownIt-Anchor" href="#博客前台-导航条"></a> 博客前台 导航条</h2>
<p>数据库查询</p>
<p>在model目录下新建 <code>category.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章类目数据模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">module.exports = class Category extends require("./model") &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取文章类目列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> getList() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> sql = <span class="string">"SELECT id,`name` FROM category ORDER BY `index` DESC"</span>;</span><br><span class="line">      <span class="keyword">this</span>.query(sql)</span><br><span class="line">        .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">          resolve(results);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">`获取文章类目列表失败：<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>把查询到的数据交给中间件</p>
<p>在middlewar目录下新建 <code>category.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Category = <span class="built_in">require</span>(<span class="string">"../model/category"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章类目中间件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取文章类目列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getList: <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    Category.getList()</span><br><span class="line">      .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">        req.categories = results;</span><br><span class="line">        next();</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        next(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在由中间件交给路由渲染到页面中</p>
<p>修改router目录下的 <code>index.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首页子应用（首页路由）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> article = <span class="built_in">require</span>(<span class="string">"../middleware/article"</span>);</span><br><span class="line"><span class="keyword">const</span> category = <span class="built_in">require</span>(<span class="string">"../middleware/category"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首页子应用</span></span><br><span class="line"><span class="keyword">const</span> indexApp = express();</span><br><span class="line"></span><br><span class="line">indexApp.get(</span><br><span class="line">  <span class="string">"/"</span>,</span><br><span class="line">  [article.getHot, article.getList, category.getList],</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; hots, articles, categories &#125; = req;</span><br><span class="line">    res.render(<span class="string">"index"</span>, &#123; hots, articles, categories &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把这个子应用导出去</span></span><br><span class="line"><span class="built_in">module</span>.exports = indexApp;</span><br></pre></td></tr></table></figure>
<p>修改views下的 <code>header.html</code> 文件</p>
<p>用ejs模板来显示路由渲染过来的数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">categories.forEach</span>(<span class="attr">category</span> =&gt;</span> &#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">category.name</span> %&gt;</span> <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125;) %&gt;</span></span><br></pre></td></tr></table></figure>
<p>启动服务。显示页面如下</p>
<p><img src= "https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/loading9.gif" data-lazy-src="https://s1.ax1x.com/2020/08/06/a2XRwd.png" alt="a2XRwd.png" /></p>
<h2 id="博客前台-文章列表"><a class="markdownIt-Anchor" href="#博客前台-文章列表"></a> 博客前台 文章列表</h2>
<p>在model目录下的 <code>article.js</code> 文件中新增方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取指定类目下的文章列表</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;integer&#125;</span> </span>id 类目编号</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> getListByCategoryId(id) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> sql =</span><br><span class="line">        <span class="string">"SELECT id,title,content,`time` FROM article WHERE category_id = ? ORDER BY time DESC"</span>;</span><br><span class="line">      <span class="keyword">this</span>.query(sql, id)</span><br><span class="line">        .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">          resolve(results);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">`获取指定类目下的文章列表失败：<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>在middleware目录下的 <code>article.js</code> 文件新增属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取指定类目下的文章</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getListByCategoryId: <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * http://127.0.0.1:3000/article/list/1</span></span><br><span class="line"><span class="comment">     * 获取路由下的id - 此时id为1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">    Article.getListByCategoryId(id)</span><br><span class="line">      .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">        req.articles = results;</span><br><span class="line">        next();</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        next(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>在router目录下新建 <code>article.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章子应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> article = <span class="built_in">require</span>(<span class="string">"../middleware/article"</span>);</span><br><span class="line"><span class="keyword">const</span> category = <span class="built_in">require</span>(<span class="string">"../middleware/category"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文章子应用</span></span><br><span class="line"><span class="keyword">const</span> articleApp = express();</span><br><span class="line"></span><br><span class="line">articleApp.get(</span><br><span class="line">  <span class="string">"/list/:id"</span>,</span><br><span class="line">  [article.getListByCategoryId, category.getList],</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; articles, categories &#125; = req;</span><br><span class="line">    res.render(<span class="string">"list"</span>, &#123; articles, categories &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = articleApp;</span><br></pre></td></tr></table></figure>
<p>修改views目录下的 <code>list.html</code> 文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">articles.forEach</span>(<span class="attr">article</span> =&gt;</span> &#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col my-3"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card h-100"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"holder.js/100px150"</span> <span class="attr">class</span>=<span class="string">"card-img-top"</span> <span class="attr">alt</span>=<span class="string">"..."</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card-body"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">"card-title"</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">article.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"card-text"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"text-muted"</span></span></span><br><span class="line"><span class="tag">              &gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">article.time.toLocaleString</span>() %&gt;</span><span class="tag">&lt;/<span class="name">small</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"card-text"</span>&gt;</span></span><br><span class="line">            &lt;%= article.content.replace(/&lt;[^&gt;]+&gt;/g,"").substring(0,100) %&gt;...</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"stretched-link"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125;) %&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后在myblog目录下的 <code>index.js</code> 入口函数中新增</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">"/article"</span>, <span class="built_in">require</span>(<span class="string">"./router/article"</span>));</span><br></pre></td></tr></table></figure>
<p>启动服务，浏览器访问 <a href="http://127.0.0.1:3000/article/list/1" target="_blank" rel="noopener">http://127.0.0.1:3000/article/list/1</a> ，出现以下页面</p>
<p><img src= "https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/loading9.gif" data-lazy-src="https://s1.ax1x.com/2020/08/06/aRnmCV.png" alt="aRnmCV.png" /></p>
<p>虽然现在输入url网址能够访问到指定类目列表，但是点击类目列表却不能访问</p>
<p>这时候应该去 <code>header.html</code> 模板文件中修改 href 路由</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">categories.forEach</span>(<span class="attr">category</span> =&gt;</span> &#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link"</span> <span class="attr">href</span>=<span class="string">"/article/list/&lt;%= category.id %&gt; "</span></span></span><br><span class="line"><span class="tag">           &gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">category.name</span> %&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125;) %&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后就是修改当前栏目后面显示的数据</p>
<p>通过id查找数据库中的name，然后进行数据显示</p>
<p>在model目录下的 <code>category.js</code> 文件中新增方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取指定编号的类目详情</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;integer&#125;</span> </span>id 类目编号</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> getCategoryById(id) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> sql = <span class="string">"SELECT id,`name`,`index` FROM category WHERE id = ?"</span>;</span><br><span class="line">      <span class="keyword">this</span>.query(sql, id)</span><br><span class="line">        .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">          resolve(results[<span class="number">0</span>]);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">`获取指定编号的类目详情失败：<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>在middleware目录下新增属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取指定的类目详情</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getCategoryById: <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">    Category.getCategoryById(id)</span><br><span class="line">      .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">        req.category = results;</span><br><span class="line">        next();</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        next(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>修改router目录下的 <code>article.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">articleApp.get(</span><br><span class="line">  <span class="string">"/list/:id"</span>,</span><br><span class="line">  [article.getListByCategoryId, category.getList, category.getCategoryById],</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; articles, categories, category &#125; = req;</span><br><span class="line">    res.render(<span class="string">"list"</span>, &#123; articles, categories, category &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>修改views目录下的 <code>list.html</code> 模板文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"mb-4"</span>&gt;</span>当前栏目：<span class="tag">&lt;<span class="name">%=</span> <span class="attr">category.name</span> %&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>启动服务，出现以下页面</p>
<p><img src= "https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/loading9.gif" data-lazy-src="https://s1.ax1x.com/2020/08/06/aR3ffA.png" alt="aR3ffA.png" /></p>
<h2 id="博客前台-文章搜索"><a class="markdownIt-Anchor" href="#博客前台-文章搜索"></a> 博客前台 文章搜索</h2>
<p>在model目录下的 <code>article.js</code> 文件下新增方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取指定关键词的文章列表</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;integer&#125;</span> </span>keyword 搜索内容</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> getListByKeyword(keyword) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> sql =</span><br><span class="line">        <span class="string">"SELECT id,title,content,`time` FROM article WHERE title LIKE ? ORDER BY time DESC"</span>;</span><br><span class="line">      <span class="keyword">this</span>.query(sql, <span class="string">`%<span class="subst">$&#123;keyword&#125;</span>%`</span>)</span><br><span class="line">        .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">          resolve(results);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">`获取指定关键词的文章列表失败：<span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">          reject(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>在middleware目录下的 <code>article.js</code> 文件中新增属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取指定类目下的文章</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getListByKeyword: <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 要获取表单的keyword</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">let</span> keyword = req.query.keyword;</span><br><span class="line">    Article.getListByKeyword(keyword)</span><br><span class="line">      .then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">        req.articles = results;</span><br><span class="line">        next();</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        next(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>在router目录下新建文件 <code>search.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索子应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> article = <span class="built_in">require</span>(<span class="string">"../middleware/article"</span>);</span><br><span class="line"><span class="keyword">const</span> category = <span class="built_in">require</span>(<span class="string">"../middleware/category"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文章子应用</span></span><br><span class="line"><span class="keyword">const</span> searchApp = express();</span><br><span class="line"></span><br><span class="line">searchApp.get(<span class="string">"/"</span>, [article.getListByKeyword, category.getList], (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; articles, categories &#125; = req;</span><br><span class="line">  res.render(<span class="string">"search"</span>, &#123; articles, categories, <span class="attr">keyword</span>: req.query.keyword &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = searchApp;</span><br></pre></td></tr></table></figure>
<p>修改views目录下的 <code>search.html</code> 模板文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>("<span class="attr">header.html</span>") <span class="attr">-</span>%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container mt-5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"mb-4"</span>&gt;</span>搜索结果（搜索词：<span class="tag">&lt;<span class="name">%=</span> <span class="attr">keyword</span> %&gt;</span> ）<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row row-cols-4"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">articles.forEach</span>(<span class="attr">article</span> =&gt;</span> &#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col my-3"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card h-100"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"holder.js/100px150"</span> <span class="attr">class</span>=<span class="string">"card-img-top"</span> <span class="attr">alt</span>=<span class="string">"..."</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card-body"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">"card-title"</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">article.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"card-text"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"text-muted"</span></span></span><br><span class="line"><span class="tag">              &gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">article.time.toLocaleString</span>() %&gt;</span><span class="tag">&lt;/<span class="name">small</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"card-text"</span>&gt;</span></span><br><span class="line">            &lt;%= article.content.replace(/&lt;[^&gt;]+&gt;/g,"").substring(0,100) %&gt;...</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"stretched-link"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125;) %&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>('<span class="attr">footer.html</span>') <span class="attr">-</span>%&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改views目录下的 <code>header.html</code> 文件的form表单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;form</span><br><span class="line">class&#x3D;&quot;form-inline my-2 my-lg-0 ml-5&quot;</span><br><span class="line">method&#x3D;&quot;get&quot;</span><br><span class="line">action&#x3D;&quot;&#x2F;search&quot;</span><br><span class="line">&gt;</span><br><span class="line">&lt;input</span><br><span class="line">class&#x3D;&quot;form-control mr-sm-2&quot;</span><br><span class="line">name&#x3D;&quot;keyword&quot;</span><br><span class="line">type&#x3D;&quot;search&quot;</span><br><span class="line">placeholder&#x3D;&quot;请输入关键词...&quot;</span><br><span class="line">&#x2F;&gt;</span><br><span class="line">&lt;button class&#x3D;&quot;btn btn-outline-success my-2 my-sm-0&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">搜索</span><br><span class="line">&lt;&#x2F;button&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>
<p>启动服务，搜索css出现以下页面</p>
<p><img src= "https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/loading9.gif" data-lazy-src="https://s1.ax1x.com/2020/08/07/aRwkNV.png" alt="aRwkNV.png" /></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:2044580857@qq.com">Continue.Run</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://extheor.github.io/posts/a7dc32c9/index.html">https://extheor.github.io/posts/a7dc32c9/index.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://extheor.github.io" target="_blank">MaXiaoYu's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Nodejs%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/">Nodejs博客系统</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/extheor/extheor.github.io/img/nodejs.jpg" data-sites="qq,wechat,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/extheor/extheor.github.io/img/wechat.png" alt="wechat" onclick="window.open('https://cdn.jsdelivr.net/gh/extheor/extheor.github.io/img/wechat.png')"/><div class="post-qr-code__desc">wechat</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://cdn.jsdelivr.net/gh/extheor/extheor.github.io/img/alipay.jpg" alt="alipay" onclick="window.open('https://cdn.jsdelivr.net/gh/extheor/extheor.github.io/img/alipay.jpg')"/><div class="post-qr-code__desc">alipay</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/posts/b24dd347/index.html"><img class="next-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/media/image/10.jpg" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hexo常用命令</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Continue.Run</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">CDN BY <a target="_blank" rel="external nofollow" href="https://www.jsdelivr.com/"><b>jsDelivr</b></a> | HOST BY <a target="_blank" rel="external nofollow" href="https://coding.net/"><b>Coding</b></a> && <a target="_blank" rel="external nofollow" href="https://github.com/"><b>Github</b></a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/js/utils.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/js/main.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.spacingElementById('content-inner')
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js', () => {
      pangu.spacingElementById('content-inner')
    })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguFn)</script><script src="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@v3.3.1/butterfly/js/search/local-search.js"></script><div class="js-pjax"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>