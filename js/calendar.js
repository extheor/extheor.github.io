"use strict";!function(q){q.fn.aCalendar=function(t,e){return this.each(function(){return function(t,e,a){var n,r=new Date,l=r.getDate(),F=r.getMonth(),O=r.getFullYear(),j=l,A=F,S=O,W=a,E=null,R=null,J={posts:[],prev:null,next:null},s="en";(n=t)&&"undefined"!=typeof calLanguages&&calLanguages[n]&&(s=n);var U=q.extend({},q.fn.aCalendar.defaults,"undefined"==typeof calLanguages?{}:calLanguages[s],e);function Y(){A<11?A++:(A=0,S++),o()}function $(){0<A?A--:(A=11,S--),o()}function N(t){t&&(S=t.getFullYear(),A=t.getMonth(),o())}function z(t){R=t.map(function(t){var e=t.split("-");return new Date(Date.UTC(+e[0],+e[1]-1))})}function P(){var t=Date.UTC(S,A);if(null===R||0===R.length)return!1;if(0===J.posts.length&&(null===J.prev&&null!==J.next&&J.next.getTime()>t||null===J.next&&null!==J.prev&&J.prev.getTime()<t))return!1;J.posts=[];for(var e=0;e<R.length;e++){var a=R[e].getTime();if(t===a)return J.prev=0===e?null:R[e-1],J.next=e===R.length-1?null:R[e+1],!0;if(t<a){J.prev=0===e?null:R[e-1],J.next=R[e];break}J.prev=R[e],J.next=null}return!1}function Q(t,e){var a={"LMM+":U.months[t.getMonth()],"MM+":t.getMonth()+1};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,"LMM+"===n?a[n]:("00"+a[n]).substr((""+a[n]).length)));return e}function o(){U.single?null!=U.url&&""!=U.url&&(null===E&&q.ajax({url:U.url,async:!1,success:function(t){E=t,z(Object.keys(E))}}),null!==E&&P()&&(J.posts=E[S+"-"+(A+1)])):(null===R&&q.ajax({url:U.root+"list.json",async:!1,success:function(t){z(t)}}),P()&&q.ajax({url:U.root+S+"-"+(A+1)+".json",async:!1,success:function(t){J.posts=t}}));var t=new Date(S,A,1).getDay()-U.weekOffset;t<=0&&(t=6- -1*(t+1));var e=new Date(S,A+1,0).getDate(),a=new Date(S,A,0).getDate()-t+1,n=q("<div/>").addClass("cal-head"),r=q("<div/>"),l=q("<div/>"),s=q("<div/>").addClass("cal-title");l.html(U.headArrows.previous),r.html(U.headArrows.next),curDate=new Date(Date.UTC(S,A)),0===J.posts.length?s.html(Q(curDate,U.titleFormat)):(cTitleLink=q("<a/>").attr("href",Q(curDate,U.titleLinkFormat)).attr("title",Q(curDate,U.postsMonthTip)).html(Q(curDate,U.titleFormat)),s.html(cTitleLink)),l.on("click",$),r.on("click",Y),n.append(l),n.append(s),n.append(r);for(var o=q("<table/>").addClass("cal"),u=U.weekOffset,p=q("<thead/>"),d=q("<tr/>"),i=0;i<7;i++){6<u&&(u=0);var c=q("<th/>").attr("scope","col").attr("title",U.dayOfWeek[u]);c.html(U.dayOfWeekShort[u]),d.append(c),u++}p.append(d),o.append(p);var f=q("<tfoot/>"),h=q("<tr/>"),y=q("<td/>").attr("colspan",3),g=q("<td/>").html("&nbsp;"),v=q("<td/>").attr("colspan",3);J.prev&&y.html(U.footArrows.previous+U.months[J.prev.getMonth()]).addClass("cal-foot").attr("title",Q(J.prev,U.postsMonthTip)),J.next&&v.html(U.months[J.next.getMonth()]+U.footArrows.next).addClass("cal-foot").attr("title",Q(J.next,U.postsMonthTip)),y.on("click",function(){N(J.prev)}),v.on("click",function(){N(J.next)}),h.append(y),h.append(g),h.append(v),f.append(h);var m=q("<tbody/>"),M=1,x=1;for(i=0;i<6;i++){for(var D=q("<tr/>"),k=0;k<7;k++){var w=q("<td/>");if(7*i+k<t)w.addClass("cal-gray"),w.html(a++);else if(M<=e){M==j&&F==A&&O==S&&w.addClass("cal-today");for(var C={num:0,keys:[]},T=0;T<J.posts.length;T++)new Date(Date.parse(J.posts[T].date)).getDate()==M&&(C.keys[C.num++]=T);if(0!==C.num){var b=C.keys[0],L=q("<a>").attr("href",J.posts[b].link).attr("title",J.posts[b].title).html(M++);w.append(L)}else w.html(M++)}else w.addClass("cal-gray"),w.html(x++);D.append(w)}m.append(D)}o.append(p),o.append(f),o.append(m),q(W).html(n),q(W).append(o)}return"/"!==U.root[0]&&(U.root="/"+U.root),"/"!==U.root[U.root.length-1]&&(U.root+="/"),o()}(t,e,q(this))})},q.fn.aCalendar.defaults={months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeekShort:["S","M","T","W","T","F","S"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],postsMonthTip:"Posts published in LMM yyyy",titleFormat:"yyyy LMM",titleLinkFormat:"/archives/yyyy/MM/",headArrows:{previous:'<span class="cal-prev"></span>',next:'<span class="cal-next"></span>'},footArrows:{previous:"« ",next:" »"},weekOffset:0,single:!0,root:"/calendar/",url:"/calendar.json"},q(document).ready(function(){q("#calendar").aCalendar("zh-CN")})}(jQuery);